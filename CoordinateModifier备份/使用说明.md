# 坐标系修改插件使用说明

## 指令结构说明

详细指令结构说明请参考 [指令说明.md](指令说明.md)

**快速理解：**
- `CALL_SERVICE` = 调用服务指令（系统固定格式）
- `CM` = 插件名称（Coordinate Modifier的缩写）
- `Set_coord` = 函数名（Set Coordinate的缩写，设置坐标系）
- `(1,1,1,100.5)` = 参数（按顺序：坐标系类型, 坐标系ID, 参数编号, 值）

## 使用模板

详细使用模板请参考 [使用模板.md](使用模板.md)

**重要说明：**
- 插件使用**长连接机制**，**不需要手动创建连接**
- 第一次调用指令时会自动建立连接
- 后续调用会复用连接，提高效率

## 一、插件安装

1. **导入插件**
   - 在机器人系统的插件管理界面，选择"导入插件"
   - 选择 `CM_v0.1_20251124.gbtapp` 文件
   - 等待安装完成

2. **验证安装**
   - 确认插件列表中显示 `CM` 插件
   - 插件类型：简单服务（easyService）
   - 版本：0.1

## 二、在编程界面中使用

### 指令1：修改坐标系单个参数值（直接传值）

**指令格式：**
```
CALL_SERVICE CM Set_coord(coord_type,id,param_id,value)
```

**参数说明（位置参数，按顺序）：**
1. **coord_type**: 坐标系类型
   - `1` = TF（工具坐标系）
   - `2` = UF（用户坐标系）
   - 也支持字符串：`TF` 或 `UF`
2. **id**: 坐标系ID（1-30，0是基础坐标系不可修改）
3. **param_id**: 参数编号（1-6）
   - 1 = X（位置，单位：mm）
   - 2 = Y（位置，单位：mm）
   - 3 = Z（位置，单位：mm）
   - 4 = A（角度，单位：度）
   - 5 = B（角度，单位：度）
   - 6 = C（角度，单位：度）
4. **value**: 要设置的值（浮点数，保留三位小数）

**使用示例：**

示例1：修改工具坐标系1的X坐标为100.5mm
```
CALL_SERVICE CM Set_coord(1,1,1,100.5)
```

示例2：修改工具坐标系1的Y坐标为200.0mm
```
CALL_SERVICE CM Set_coord(1,1,2,200.0)
```

示例3：修改用户坐标系2的A角度为45.0度
```
CALL_SERVICE CM Set_coord(2,2,4,45.0)
```

### 指令2：修改坐标系单个参数值（从R寄存器读取）

**指令格式：**
```
CALL_SERVICE CM Set_coord_r(coord_type,id,param_id,r_id)
```

**参数说明（位置参数，按顺序）：**
1. **coord_type**: 坐标系类型（1=TF, 2=UF）
2. **id**: 坐标系ID（1-30）
3. **param_id**: 参数编号（1=X, 2=Y, 3=Z, 4=A, 5=B, 6=C）
4. **r_id**: R寄存器编号

**使用示例：**

从R寄存器5读取值，更新工具坐标系1的X坐标
```
CALL_SERVICE CM Set_coord_r(1,1,1,5)
```

### 指令3：从PR寄存器更新整个坐标系

**指令格式：**
```
CALL_SERVICE CM Set_coord_pr(coord_type,id,pr_id)
```

**参数说明（位置参数，按顺序）：**
1. **coord_type**: 坐标系类型（1=TF, 2=UF）
2. **id**: 坐标系ID（1-30）
3. **pr_id**: PR寄存器编号

**使用示例：**

从PR寄存器5读取XYZABC值，更新工具坐标系1
```
CALL_SERVICE CM Set_coord_pr(1,1,5)
```

## 三、完整使用流程示例

### 场景：修改工具坐标系的位置和姿态

**步骤1：准备数据**
- 将新的坐标值写入PR寄存器（例如PR5）
  - X = 100.0mm
  - Y = 200.0mm
  - Z = 300.0mm
  - A = 0.0度
  - B = 0.0度
  - C = 0.0度

**步骤2：在程序中添加指令**
```
CALL_SERVICE CM Set_coord_pr(1,1,5)
```

**步骤3：运行程序**
- 执行程序后，工具坐标系1的值将被更新为PR寄存器5中的值

### 场景：单独修改坐标系的某个参数

**示例：只修改X坐标**
```
CALL_SERVICE CM Set_coord(1,1,1,150.0)
```

## 四、注意事项

1. **坐标系索引范围**：id 必须在 1-30 之间，0是基础坐标系，不可修改

2. **坐标系类型表示**：
   - 可以使用字符串：`TF`（工具坐标系）或 `UF`（用户坐标系）
   - 也可以使用数值：`1`（工具坐标系）或 `2`（用户坐标系）

3. **参数编号**：
   - 1-3 对应位置（X, Y, Z），单位：毫米（mm）
   - 4-6 对应姿态（A, B, C），单位：度（°）

4. **数据精度**：所有数值保留三位小数

5. **R寄存器使用**：使用R寄存器时，确保寄存器中已有正确的数值

6. **PR寄存器使用**：PR寄存器必须包含完整的位姿数据（XYZABC）

## 五、故障排除

### 问题1：指令执行失败
- 检查坐标系索引ID是否在有效范围内（1-30）
- 检查参数编号是否正确（1-6）
- 检查坐标系类型是否正确（TF/UF或1/2）
- 检查R/PR寄存器是否存在且包含数据

### 问题2：坐标值未更新
- 确认机器人已连接
- 检查是否有权限修改坐标系
- 查看日志信息获取详细错误

### 问题3：插件未找到
- 确认插件已正确安装
- 检查插件名称拼写是否正确：`CM`
- 确认函数名称拼写正确：`Set_coord`、`Set_coord_r`、`Set_coord_pr`

## 六、函数列表

插件提供以下三个函数：

1. **Set_coord** - 修改坐标系单个参数（直接值）
2. **Set_coord_r** - 修改坐标系单个参数（从R寄存器）
3. **Set_coord_pr** - 从PR寄存器更新整个坐标系
