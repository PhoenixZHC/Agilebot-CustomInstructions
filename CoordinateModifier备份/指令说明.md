# 指令结构详细说明

## 指令格式解析

以 `CALL_SERVICE CM Set_coord(1,1,1,100.5)` 为例，详细解释每个部分的含义：

### 完整指令结构

```
CALL_SERVICE CM Set_coord(1,1,1,100.5)
│           │  │         │ │ │ │
│           │  │         │ │ │ └─ 第4个参数：value（要设置的值）
│           │  │         │ │ └─── 第3个参数：param_id（参数编号）
│           │  │         │ └───── 第2个参数：id（坐标系ID）
│           │  │         └─────── 第1个参数：coord_type（坐标系类型）
│           │  └───────────────── 函数名（Set coordinate的缩写）
│           └───────────────────── 插件名称（Coordinate Modifier的缩写）
└───────────────────────────────── 系统指令（调用服务）
```

## 各部分详细说明

### 1. CALL_SERVICE（系统指令）

**含义**：调用服务
- 这是机器人编程语言中的系统指令
- 用于调用插件服务（简单服务或通用服务）
- 相当于编程中的"函数调用"指令

### 2. CM（插件名称）

**含义**：Coordinate Modifier（坐标系修改器）的缩写
- **C** = Coordinate（坐标系）
- **M** = Modifier（修改器）
- 这是插件的名称，在 `config.json` 中定义

### 3. Set_coord（函数名）

**含义**：Set Coordinate（设置坐标系）的缩写
- **Set** = 设置
- **coord** = coordinate（坐标系）的缩写
- 表示这个函数用于设置/修改坐标系的值

**其他函数名：**
- `Set_coord_r` = Set Coordinate from Register（从寄存器设置坐标系）
  - `_r` 表示从 R 寄存器读取值
- `Set_coord_pr` = Set Coordinate from Pose Register（从位姿寄存器设置坐标系）
  - `_pr` 表示从 PR 寄存器读取完整的位姿值

### 4. 括号内的参数（位置参数）

参数按顺序传递，用逗号分隔：

#### Set_coord(coord_type, id, param_id, value)

**第1个参数：coord_type（坐标系类型）**
- `1` = TF（Tool Frame，工具坐标系）
- `2` = UF（User Frame，用户坐标系）
- 也支持字符串：`TF` 或 `UF`

**第2个参数：id（坐标系ID）**
- 范围：1-30
- 表示要修改第几个坐标系
- 例如：`1` 表示坐标系1，`2` 表示坐标系2
- 注意：0是基础坐标系，不可修改

**第3个参数：param_id（参数编号）**
- 范围：1-6
- 表示要修改坐标系的哪个参数：
  - `1` = X（X轴位置，单位：mm）
  - `2` = Y（Y轴位置，单位：mm）
  - `3` = Z（Z轴位置，单位：mm）
  - `4` = A（绕X轴旋转角度，单位：度）
  - `5` = B（绕Y轴旋转角度，单位：度）
  - `6` = C（绕Z轴旋转角度，单位：度）

**第4个参数：value（要设置的值）**
- 浮点数
- 单位：mm（位置参数）或 度（角度参数）
- 精度：保留三位小数
- 例如：`100.5` 表示 100.5mm 或 100.5度

#### Set_coord_r(coord_type, id, param_id, r_id)

**前3个参数**：与 Set_coord 相同

**第4个参数：r_id（R寄存器编号）**
- 整数
- 表示从哪个R寄存器读取值
- 例如：`5` 表示从R寄存器5读取值

#### Set_coord_pr(coord_type, id, pr_id)

**第1个参数：coord_type**（同上）

**第2个参数：id**（同上）

**第3个参数：pr_id（PR寄存器编号）**
- 整数
- 表示从哪个PR寄存器读取完整的XYZABC值
- 例如：`5` 表示从PR寄存器5读取完整的位姿数据

## 完整示例解析

### 示例1：CALL_SERVICE CM Set_coord(1,1,1,100.5)

**逐字解析：**
- `CALL_SERVICE` = 调用服务指令
- `CM` = 使用CM插件
- `Set_coord` = 调用设置坐标系函数
- `(1,1,1,100.5)` = 传入4个参数：
  - `1` = 工具坐标系（TF）
  - `1` = 坐标系1
  - `1` = X坐标
  - `100.5` = 设置为100.5mm

**完整含义**：将工具坐标系1的X坐标设置为100.5mm

### 示例2：CALL_SERVICE CM Set_coord(2,2,4,45.0)

**逐字解析：**
- `CALL_SERVICE` = 调用服务指令
- `CM` = 使用CM插件
- `Set_coord` = 调用设置坐标系函数
- `(2,2,4,45.0)` = 传入4个参数：
  - `2` = 用户坐标系（UF）
  - `2` = 坐标系2
  - `4` = A角度
  - `45.0` = 设置为45.0度

**完整含义**：将用户坐标系2的A角度设置为45.0度

### 示例3：CALL_SERVICE CM Set_coord_r(1,1,1,5)

**逐字解析：**
- `CALL_SERVICE` = 调用服务指令
- `CM` = 使用CM插件
- `Set_coord_r` = 调用从R寄存器设置坐标系函数
- `(1,1,1,5)` = 传入4个参数：
  - `1` = 工具坐标系（TF）
  - `1` = 坐标系1
  - `1` = X坐标
  - `5` = 从R寄存器5读取值

**完整含义**：从R寄存器5读取值，更新工具坐标系1的X坐标

### 示例4：CALL_SERVICE CM Set_coord_pr(1,1,5)

**逐字解析：**
- `CALL_SERVICE` = 调用服务指令
- `CM` = 使用CM插件
- `Set_coord_pr` = 调用从PR寄存器设置坐标系函数
- `(1,1,5)` = 传入3个参数：
  - `1` = 工具坐标系（TF）
  - `1` = 坐标系1
  - `5` = 从PR寄存器5读取完整的XYZABC值

**完整含义**：从PR寄存器5读取完整的位姿数据（XYZABC），更新工具坐标系1

## 参数对应关系速查表

### 坐标系类型（coord_type）
| 值 | 含义 | 说明 |
|---|---|---|
| 1 | TF | Tool Frame（工具坐标系） |
| 2 | UF | User Frame（用户坐标系） |

### 参数编号（param_id）
| 值 | 参数 | 单位 | 说明 |
|---|---|---|---|
| 1 | X | mm | X轴位置 |
| 2 | Y | mm | Y轴位置 |
| 3 | Z | mm | Z轴位置 |
| 4 | A | 度 | 绕X轴旋转角度（欧拉角） |
| 5 | B | 度 | 绕Y轴旋转角度（欧拉角） |
| 6 | C | 度 | 绕Z轴旋转角度（欧拉角） |

## 记忆技巧

1. **CALL_SERVICE** = 调用服务（固定格式）
2. **CM** = 坐标系修改器（插件名）
3. **Set_coord** = 设置坐标系（函数名）
4. **参数顺序**：坐标系类型 → 坐标系ID → 参数编号 → 值/寄存器编号



