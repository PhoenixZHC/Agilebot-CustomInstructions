# 坐标系修改插件使用说明

## 插件架构（分层结构）

### 第一层：选择坐标系类型
- **SetTF** - 工具坐标系（Tool Frame）
- **SetUF** - 用户坐标系（User Frame）

### 第二层：选择输入方式

#### 数值输入
- **直接输入**：`SetTF(id, x, y, z, a, b, c)` 或 `SetUF(id, x, y, z, a, b, c)`
- **R寄存器输入**：`SetTFR(id, param_name, r_id)` 或 `SetUFR(id, param_name, r_id)`
  - `param_name` 可选择：`X`, `Y`, `Z`, `A`, `B`, `C`

#### PR位姿寄存器
- **PR寄存器输入**：`SetTFPR(id, pr_id)` 或 `SetUFPR(id, pr_id)`

## 一、插件安装

1. **导入插件**
   - 在机器人系统的插件管理界面，选择"导入插件"
   - 选择 `CM_v0.1_*.gbtapp` 文件
   - 等待安装完成

2. **验证安装**
   - 确认插件列表中显示 `CM` 插件
   - 插件类型：简单服务（easyService）
   - 版本：0.1

## 二、在编程界面中使用

### 指令结构说明

在机器人编程界面中，指令会按以下层次显示：

```
CALL_SERVICE CM
  ├─ SetTF*          (选择工具坐标系，*表示需要选择ID号)
  │   ├─ SetTFid,x,y,z,a,b,c             (直接输入，无括号)
  │   ├─ SetTFid,param_name,R寄存器编号   (R寄存器输入，无括号)
  │   └─ SetTFid,PR寄存器编号             (PR寄存器输入，无括号)
  └─ SetUF*          (选择用户坐标系，*表示需要选择ID号)
      ├─ SetUFid,x,y,z,a,b,c             (直接输入，无括号)
      ├─ SetUFid,param_name,R寄存器编号   (R寄存器输入，无括号)
      └─ SetUFid,PR寄存器编号             (PR寄存器输入，无括号)
```

### 指令1：修改工具坐标系（SetTF）

#### 1.1 直接输入XYZABC值

**指令格式（无括号）：**
```
CALL_SERVICE CM SetTFid,x,y,z,a,b,c
```

**参数说明（位置参数，按顺序）：**
1. **id**: 坐标系ID（1-30，0是基础坐标系不可修改）
2. **x**: X坐标值（单位：mm，保留3位小数）
3. **y**: Y坐标值（单位：mm，保留3位小数）
4. **z**: Z坐标值（单位：mm，保留3位小数）
5. **a**: A角度值（单位：度，保留3位小数）
6. **b**: B角度值（单位：度，保留3位小数）
7. **c**: C角度值（单位：度，保留3位小数）

**使用示例：**

示例1：修改工具坐标系1的完整参数
```
CALL_SERVICE CM SetTF1,100.000,200.000,300.000,1.000,2.000,3.000
```

示例2：只修改位置，保持角度不变（设置为0）
```
CALL_SERVICE CM SetTF1,150.000,250.000,350.000,0.000,0.000,0.000
```

#### 1.2 从R寄存器输入单个参数

**指令格式（无括号）：**
```
CALL_SERVICE CM SetTFid,param_name,R寄存器编号
```

**参数说明（位置参数，按顺序）：**
1. **id**: 坐标系ID（1-30）
2. **param_name**: 参数名称（字符串，可选：`X`, `Y`, `Z`, `A`, `B`, `C`）
3. **r_id**: R寄存器编号

**使用示例：**

示例1：从R寄存器5读取值，更新工具坐标系1的X坐标
```
CALL_SERVICE CM SetTF1,X,R5
```

示例2：从R寄存器10读取值，更新工具坐标系1的A角度
```
CALL_SERVICE CM SetTF1,A,R10
```

#### 1.3 从PR寄存器输入完整XYZABC值

**指令格式（无括号）：**
```
CALL_SERVICE CM SetTFid,PR寄存器编号
```

**参数说明（位置参数，按顺序）：**
1. **id**: 坐标系ID（1-30）
2. **pr_id**: PR寄存器编号（读取完整的XYZABC值）

**使用示例：**

示例：从PR寄存器5读取完整的XYZABC值，更新工具坐标系1
```
CALL_SERVICE CM SetTF1,PR5
```

### 指令2：修改用户坐标系（SetUF）

#### 2.1 直接输入XYZABC值

**指令格式：**
```
CALL_SERVICE CM SetUF(id,x,y,z,a,b,c)
```

**参数说明：** 同SetTF的直接输入

**使用示例：**

示例1：修改用户坐标系1的完整参数
```
CALL_SERVICE CM SetUF1,50.000,100.000,150.000,45.000,30.000,60.000
```

#### 2.2 从R寄存器输入单个参数

**指令格式：**
```
CALL_SERVICE CM SetUFR(id,param_name,r_id)
```

**参数说明：** 同SetTFR

**使用示例：**

示例：从R寄存器5读取值，更新用户坐标系1的X坐标
```
CALL_SERVICE CM SetUF1,X,R5
```

#### 2.3 从PR寄存器输入完整XYZABC值

**指令格式：**
```
CALL_SERVICE CM SetUFPR(id,pr_id)
```

**参数说明：** 同SetTFPR

**使用示例：**

示例：从PR寄存器5读取完整的XYZABC值，更新用户坐标系1
```
CALL_SERVICE CM SetUF1,PR5
```

## 三、参数说明

### 坐标系ID（id）
- **范围**：1-30
- **说明**：0是基础坐标系，不可修改

### 参数名称（param_name）
- **可选值**：`X`, `Y`, `Z`, `A`, `B`, `C`
- **说明**：
  - `X`, `Y`, `Z`：位置参数（单位：mm）
  - `A`, `B`, `C`：角度参数（单位：度）

### 数据精度
- 所有数值自动保留**三位小数**
- 位置单位：**毫米（mm）**
- 角度单位：**度（°）**

## 四、重要说明

1. **长连接机制**：插件使用长连接机制，不需要手动创建连接，第一次调用时会自动建立连接。

2. **参数顺序**：所有参数都是位置参数，必须按顺序传递。

3. **坐标系类型**：
   - `SetTF` 系列：工具坐标系（Tool Frame）
   - `SetUF` 系列：用户坐标系（User Frame）

4. **输入方式选择**：
   - **直接输入**：适用于已知具体数值的情况
   - **R寄存器输入**：适用于从R寄存器读取单个参数值
   - **PR寄存器输入**：适用于从PR寄存器读取完整的位姿数据（XYZABC）

## 五、常见问题

### Q1: 如何只修改坐标系的X坐标？
**A:** 使用R寄存器输入方式：
```
CALL_SERVICE CM SetTF1,X,R寄存器编号
```

### Q2: 如何从PR寄存器更新整个坐标系？
**A:** 使用PR寄存器输入方式：
```
CALL_SERVICE CM SetTF坐标系ID,PR寄存器编号
```

### Q3: 坐标系ID范围是多少？
**A:** 1-30（0是基础坐标系，不可修改）

### Q4: 数据精度是多少？
**A:** 所有数值自动保留三位小数，位置单位是mm，角度单位是度。
